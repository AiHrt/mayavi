

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Advanced Scripting with Mayavi &mdash; mayavi 4.2.1 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '4.2.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="mayavi 4.2.1 documentation" href="index.html" />
    <link rel="up" title="Advanced use of Mayavi" href="advanced_use.html" />
    <link rel="next" title="Building applications using Mayavi" href="building_applications.html" />
    <link rel="prev" title="Objects populating the Mayavi pipeline" href="mayavi_objects.html" />
<style type="text/css">
  body {
    /* Very bottom copyright, etc. info */
    background: #4d598d;
  }

  .documentwrapper {
    /* Blank area on left bar */
    background: #24326e;
  }

  .related {
    /* Long horizontal nav bars */
    background: #3c4b8a!important;
  }

  .sphinxsidebarwrapper {
    /* Filled part of left sidebar */
    background: #24326e;
  }

  a {
    color: #253370;
  }

  .sphinxsidebarwrapper a {
    color: #f2f2f2!important;
  }
</style>

  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="building_applications.html" title="Building applications using Mayavi"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="mayavi_objects.html" title="Objects populating the Mayavi pipeline"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">mayavi 4.2.1 documentation</a> &raquo;</li>
          <li><a href="advanced_use.html" accesskey="U">Advanced use of Mayavi</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="advanced-scripting-with-mayavi">
<span id="id1"></span><h1>Advanced Scripting with Mayavi<a class="headerlink" href="#advanced-scripting-with-mayavi" title="Permalink to this headline">¶</a></h1>
<p>As elaborated in the <a class="reference internal" href="overview.html#an-overview-of-mayavi"><em>An overview of Mayavi</em></a> section, Mayavi can be
scripted from Python in order to visualize data.  Mayavi was designed
from the ground up to be highly scriptable.  Everything that can be done
from the user interface can be achieved using Python scripts. Scripting
the Mayavi2 application is a great way to add domain-specific
functionality to the existing framework. In addition, understanding this
application can help you design your own applications using Mayavi as
powerful visualization library.</p>
<p>If you are not looking to script the Mayavi2 application itself or to
build an application, but looking for quick ways to get your
visualization done with simple code you may want to check out Mayavi&#8217;s
<cite>mlab</cite> module.  This is described in more detail in the
<a class="reference internal" href="mlab.html#simple-scripting-with-mlab"><em>mlab: Python scripting for 3D plotting</em></a> section.  In addition to this Mayavi
features an automatic script recording feature that automatically writes
Python scripts for you as you use the GUI.  This is described in more
detail in the <a class="reference internal" href="application.html#automatic-script-generation"><em>Recording Mayavi actions to a script</em></a> chapter.  This is
probably the easiest and most powerful way to script Mayavi.</p>
<p>However, to best understand how to script Mayavi, a reasonable
understanding of the Mayavi internals is necessary.  The following
sections provide an overview of the basic design and objects in the
Mayavi pipeline.  Subsequent sections consider specific example scripts
that are included with the Mayavi sources that illustrate the ideas.</p>
<p>Mayavi uses <a class="reference external" href="http://code.enthought.com/projects/traits">Traits</a> and <a class="reference external" href="http://code.enthought.com/projects/mayavi">TVTK</a> internally.  <a class="reference external" href="http://code.enthought.com/projects/traits">Traits</a> in many ways
changes the way we program.  So it is important to have a good idea of
Traits in order to understand Mayavi&#8217;s internals.  If you are unsure
of Traits it is a good idea to get a general idea about Traits now.
Trust me, your efforts learning Traits will not be wasted!</p>
<div class="section" id="design-overview-mayavi-as-a-visualization-framework">
<h2>Design Overview: Mayavi as a visualization framework<a class="headerlink" href="#design-overview-mayavi-as-a-visualization-framework" title="Permalink to this headline">¶</a></h2>
<p>This section provides a brief introduction to Mayavi&#8217;s internal
architecture.</p>
<p>The &#8220;big picture&#8221; of a visualization in Mayavi is that an <tt class="docutils literal"><span class="pre">Engine</span></tt>
(<tt class="docutils literal"><span class="pre">mayavi.engine.Engine</span></tt>) object manages the entire
visualization.  The <tt class="docutils literal"><span class="pre">Engine</span></tt> manages a collection of <tt class="docutils literal"><span class="pre">Scene</span></tt>
(<tt class="docutils literal"><span class="pre">mayavi.core.scene.Scene</span></tt>) objects.  In each <tt class="docutils literal"><span class="pre">Scene</span></tt>, a
user may have created any number of <tt class="docutils literal"><span class="pre">Source</span></tt>
(<tt class="docutils literal"><span class="pre">mayavi.core.source.Source</span></tt>) objects.  A <tt class="docutils literal"><span class="pre">Source</span></tt>
object can further contain any number of <tt class="docutils literal"><span class="pre">Filter</span></tt>
(<tt class="docutils literal"><span class="pre">mayavi.core.filter.Filter</span></tt>) or <tt class="docutils literal"><span class="pre">ModuleManager</span></tt>
(<tt class="docutils literal"><span class="pre">mayavi.core.module_manager.ModuleManager</span></tt>) objects.  A
<tt class="docutils literal"><span class="pre">Filter</span></tt> may contain either other <tt class="docutils literal"><span class="pre">filters</span></tt> or <tt class="docutils literal"><span class="pre">ModuleManagers</span></tt>.  A
<tt class="docutils literal"><span class="pre">ModuleManager</span></tt> manages any number of <tt class="docutils literal"><span class="pre">Modules</span></tt>.  The figure below
shows this hierarchy in a graphical form.</p>
<img alt="Illustration of the various objects in the Mayavi pipeline." src="_images/m2_big_picture.png" />
<p><em>Illustration of the various objects in the Mayavi pipeline.</em></p>
<p>This hierarchy is precisely what is seen in the Mayavi tree view on
the UI.  The UI is therefore merely a graphical representation of this
internal world-view.  A little more detail on these objects is given
below.  For even more details please refer to the source code (hint: the
source code of a class can be view in IPython by entering <cite>Class??</cite>).</p>
<div class="section" id="object-oriented-construction-of-a-visualization">
<span id="oo-construction-visualization"></span><h3>Object-oriented construction of a visualization<a class="headerlink" href="#object-oriented-construction-of-a-visualization" title="Permalink to this headline">¶</a></h3>
<p>When scripting Mayavi to create or modify a visualization, one mainly
deals with adding or removing objects to the engine, or modifying their
properties. We can thus rewrite the example of building a pipeline with
mlab visited in <a class="reference internal" href="mlab_pipeline.html#controlling-the-pipeline-with-mlab-scripts"><em>Assembling pipelines with mlab</em></a> by
explicit calls to the engine:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="kn">from</span> <span class="nn">mayavi.api</span> <span class="kn">import</span> <span class="n">Engine</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">Engine</span><span class="p">()</span>
<span class="n">e</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">new_scene</span><span class="p">()</span>
<span class="kn">from</span> <span class="nn">mayavi.sources.api</span> <span class="kn">import</span> <span class="n">ArraySource</span>
<span class="n">src</span> <span class="o">=</span> <span class="n">ArraySource</span><span class="p">(</span><span class="n">scalar_data</span><span class="o">=</span><span class="n">a</span><span class="p">)</span>
<span class="n">e</span><span class="o">.</span><span class="n">add_source</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">mayavi.filters.api</span> <span class="kn">import</span> <span class="n">WarpScalar</span><span class="p">,</span> <span class="n">PolyDataNormals</span>
<span class="n">warp</span> <span class="o">=</span> <span class="n">WarpScalar</span><span class="p">()</span>
<span class="n">e</span><span class="o">.</span><span class="n">add_filter</span><span class="p">(</span><span class="n">warp</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="n">src</span><span class="p">)</span>
<span class="n">normals</span> <span class="o">=</span> <span class="n">PolyDataNormals</span><span class="p">()</span>
<span class="n">e</span><span class="o">.</span><span class="n">add_filter</span><span class="p">(</span><span class="n">normals</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="n">warp</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">mayavi.modules.api</span> <span class="kn">import</span> <span class="n">Surface</span>
<span class="n">surf</span> <span class="o">=</span> <span class="n">Surface</span><span class="p">()</span>
<span class="n">e</span><span class="o">.</span><span class="n">add_module</span><span class="p">(</span><span class="n">surf</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="n">normals</span><span class="p">)</span>
</pre></div>
</div>
<p>As with all Mayavi code, you need to have the GUI mainloop running to
have the visualization go live. Typing this code in <cite>ipython -wthread</cite>
(or <cite>ipython &#8211;gui=wx</cite> in the recent versions) will do this for you.</p>
<p>This explicit, object-oriented, code thus mirrors the <cite>mlab.pipeline</cite>
code. It is more fine-grained, and gives you more control. For instance
it separates initialization of the objects, and their addition or removal
to an engine. In general, it is more suited to developing an application,
as opposed to a script.</p>
</div>
<div class="section" id="life-cycle-of-the-different-objects">
<h3>Life-cycle of the different objects<a class="headerlink" href="#life-cycle-of-the-different-objects" title="Permalink to this headline">¶</a></h3>
<p>All objects in the Mayavi pipeline feature <tt class="docutils literal"><span class="pre">start</span></tt> and <tt class="docutils literal"><span class="pre">stop</span></tt>
methods.  The reasoning for this is that any object in Mayavi is not
usable (i.e. it may not provide any outputs) unless it has been
started.  Similarly the <tt class="docutils literal"><span class="pre">stop</span></tt> method &#8220;deactivates&#8221; the object.
This is done because Mayavi is essentially driving VTK objects
underneath.  These objects require inputs in order to do anything
useful.  Thus, an object that is not connected to the pipeline cannot
be used.  For example, consider an <tt class="docutils literal"><span class="pre">IsoSurface</span></tt> module.  It requires
some data in order to contour anything.  Thus, the module in isolation
is completely useless.  It is usable only when it is added to the
Mayavi pipeline.  When an object is added to the pipeline, its inputs
are setup and its <tt class="docutils literal"><span class="pre">start</span></tt> method is called automatically.  When the
object is removed from the pipeline its <tt class="docutils literal"><span class="pre">stop</span></tt> method is called
automatically.  Note that if you are looking to remove an object from
the mayavi pipeline, you can use the <tt class="docutils literal"><span class="pre">remove</span></tt> method to do so.  For
example (the following will require that you use <tt class="docutils literal"><span class="pre">ipython</span> <span class="pre">-wthread</span></tt> or
<cite>ipython &#8211;gui=wx</cite>):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mayavi.api</span> <span class="kn">import</span> <span class="n">Engine</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">e</span> <span class="o">=</span> <span class="n">Engine</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">e</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">new_scene</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mayavi.sources.api</span> <span class="kn">import</span> <span class="n">ParametricSurface</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="n">ParametricSurface</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">e</span><span class="o">.</span><span class="n">add_source</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="c"># calls p.start internally.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span> <span class="c"># Removes p from the engine.</span>
</pre></div>
</div>
<p>Apart from the <tt class="docutils literal"><span class="pre">Engine</span></tt> object, all other objects in the Mayavi
pipeline feature a <tt class="docutils literal"><span class="pre">scene</span></tt> trait which refers to the current
<tt class="docutils literal"><span class="pre">tvtk.pyface.tvtk_scene.TVTKScene</span></tt> instance that the
object is associated with.  The objects also feature an <tt class="docutils literal"><span class="pre">add_child</span></tt>
method that lets one build up the pipeline by adding &#8220;children&#8221;
objects.  The <tt class="docutils literal"><span class="pre">add_child</span></tt> method is &#8220;intelligent&#8221; and will try to
appropriately add the child in the right place based on the context.</p>
</div>
</div>
<div class="section" id="scripting-the-mayavi2-application">
<h2>Scripting the <tt class="docutils literal"><span class="pre">mayavi2</span></tt> application<a class="heade